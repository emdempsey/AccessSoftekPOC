{
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "BetaAppNSGName": {
      "type": "string"
    },
    "BetaAppSubnetAddressPrefix": {
      "type": "string"
    },
    "BetaDataNSGName": {
      "type": "string"
    },
    "BetaDataSubnetAddressPrefix": {
      "type": "string"
    },
    "BetaWebNSGName": {
      "type": "string"
    },
    "BetaWebSubnetAddressPrefix": {
      "type": "string"
    },
    "customerLocation": {
      "type": "string"
    },
    "DevAppNSGName": {
      "type": "string"
    },
    "DevAppSubnetAddressPrefix": {
      "type": "string"
    },
    "DevBetaMgmtNSGName": {
      "type": "string"
    },
    "DevBetaMgmtSubnetAddressPrefix": {
      "type": "string"
    },
    "DevDataNSGName": {
      "type": "string"
    },
    "DevDataSubnetAddressPrefix": {
      "type": "string"
    },
    "DevWebNSGName": {
      "type": "string"
    },
    "DevWebSubnetAddressPrefix": {
      "type": "string"
    },
    "ProdAppNSGName": {
      "type": "string"
    },
    "ProdAppSubnetAddressPrefix": {
      "type": "string"
    },
    "ProdDataNSGName": {
      "type": "string"
    },
    "ProdDataSubnetAddressPrefix": {
      "type": "string"
    },
    "ProdWebNSGName": {
      "type": "string"
    },
    "ProdWebSubnetAddressPrefix": {
      "type": "string"
    },
    "PubNSGName": {
      "type": "string"
    },
    "PubSubnetAddressPrefix": {
      "type": "string"
    },
    "StgAppNSGName": {
      "type": "string"
    },
    "StgAppSubnetAddressPrefix": {
      "type": "string"
    },
    "StgDataNSGName": {
      "type": "string"
    },
    "StgDataSubnetAddressPrefix": {
      "type": "string"
    },
    "StgProdMgmtNSGName": {
      "type": "string"
    },
    "StgProdMgmtSubnetAddressPrefix": {
      "type": "string"
    },
    "StgWebNSGName": {
      "type": "string"
    },
    "StgWebSubnetAddressPrefix": {
      "type": "string"
    }
  },
  "variables": {
  },
  "resources": [
    //Public security policies
    {
      "apiVersion": "2015-05-01-preview",
      "type": "Microsoft.Network/networkSecurityGroups",
      "name": "[parameters('PubNSGName')]",
      "location": "[parameters('customerLocation')]",
      "tags": {
        "displayName": "Public Subnet NSG"
      },
      "properties": {
        "securityRules": [
          {
            "name": "HTTP_Inbound_Internet",
            "properties": {
              "description": "This rule allows inbound HTTP traffic from the internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "Internet",
              "destinationPortRange": "80",
              "destinationAddressPrefix": "[parameters('PubSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 100
            }
          },
          {
            "name": "HTTPS_Inbound_Internet",
            "properties": {
              "description": "This rule allows inbound HTTP traffic from the internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "Internet",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "[parameters('PubSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 101
            }
          },
          {
            "name": "Allow_Inbound_LoadBalancer",
            "properties": {
              "description": "This rule allows inbound traffic from the Azure load balancers",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "AZURE_LOADBALANCER",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "[parameters('PubSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 198
            }
          },
          {
            "name": "Deny_Inbound_All",
            "properties": {
              "description": "This rule denies all inbound traffic not otherwise allowed from all sources",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "*",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "[parameters('PubSubnetAddressPrefix')]",
              "access": "Deny",
              "direction": "Inbound",
              "priority": 199
            }
          },
          {
            "name": "HTTP_Outbound_DevWeb",
            "properties": {
              "description": "This rule allows outbound HTTP traffic to the Dev Web Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('PubSubnetAddressPrefix')]",
              "destinationPortRange": "80",
              "destinationAddressPrefix": "[parameters('DevWebSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 201
            }
          },
          {
            "name": "HTTPS_Outbound_DevWeb",
            "properties": {
              "description": "This rule allows outbound HTTPS traffic to the Dev Web Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('PubSubnetAddressPrefix')]",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "[parameters('DevWebSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 202
            }
          },
          {
            "name": "HTTP_Outbound_BetaWeb",
            "properties": {
              "description": "This rule allows outbound HTTP traffic to the Beta Web Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('PubSubnetAddressPrefix')]",
              "destinationPortRange": "80",
              "destinationAddressPrefix": "[parameters('BetaWebSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 203
            }
          },
          {
            "name": "HTTPS_Outbound_BetaWeb",
            "properties": {
              "description": "This rule allows outbound HTTPS traffic to the Beta Web Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('PubSubnetAddressPrefix')]",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "[parameters('BetaWebSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 204
            }
          },
          {
            "name": "HTTP_Outbound_StgWeb",
            "properties": {
              "description": "This rule allows outbound HTTP traffic to the Stg Web Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('PubSubnetAddressPrefix')]",
              "destinationPortRange": "80",
              "destinationAddressPrefix": "[parameters('StgWebSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 205
            }
          },
          {
            "name": "HTTPS_Outbound_StgWeb",
            "properties": {
              "description": "This rule allows outbound HTTPS traffic to the Stg Web Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('PubSubnetAddressPrefix')]",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "[parameters('StgWebSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 206
            }
          },
          {
            "name": "HTTP_Outbound_ProdWeb",
            "properties": {
              "description": "This rule allows outbound HTTP traffic to the Prod Web Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('PubSubnetAddressPrefix')]",
              "destinationPortRange": "80",
              "destinationAddressPrefix": "[parameters('ProdWebSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 207
            }
          },
          {
            "name": "HTTPS_Outbound_ProdWeb",
            "properties": {
              "description": "This rule allows outbound HTTPS traffic to the Prod Web Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('PubSubnetAddressPrefix')]",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "[parameters('ProdWebSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 208
            }
          },
          {
            "name": "HTTP_Outbound_Internet",
            "properties": {
              "description": "This rule allows all Outbound HTTP traffic to the Internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('PubSubnetAddressPrefix')]",
              "destinationPortRange": "80",
              "destinationAddressPrefix": "Internet",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 297
            }
          },
          {
            "name": "HTTPS_Outbound_Internet",
            "properties": {
              "description": "This rule allows all Outbound HTTPS traffic to the Internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('PubSubnetAddressPrefix')]",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "Internet",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 298
            }
          },
          {
            "name": "Deny_Outbound_All",
            "properties": {
              "description": "This rule denies all Outbound traffic not otherwise allowed to all destinations",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('PubSubnetAddressPrefix')]",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "*",
              "access": "Deny",
              "direction": "Inbound",
              "priority": 299
            }
          }
        ]
      }
    },
    //DevBeta Mgmt security policies
    {
      "apiVersion": "2015-05-01-preview",
      "type": "Microsoft.Network/networkSecurityGroups",
      "name": "[parameters('DevBetaMgmtNSGName')]",
      "location": "[parameters('customerLocation')]",
      "tags": {
        "displayName": "Dev-Beta Mgmt Subnet NSG"
      },
      "properties": {
        "securityRules": [
          {
            "name": "HTTPS_Inbound_Internet",
            "properties": {
              "description": "This rule allows inbound HTTPS traffic from the Internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "Internet",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 100
            }
          },
          {
            "name": "RDP_Inbound_Internet",
            "properties": {
              "description": "This rule allows inbound RDP traffic from the Dev-Beta Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "Internet",
              "destinationPortRange": "3389",
              "destinationAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 101
            }
          },
          {
            "name": "LDAP_Inbound_DevWeb",
            "properties": {
              "description": "This rule allows inbound LDAP traffic from the Dev Web Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevWebSubnetAddressPrefix')]",
              "destinationPortRange": "389",
              "destinationAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 102
            }
          },
          {
            "name": "LDAP_Inbound_DevApp",
            "properties": {
              "description": "This rule allows inbound LDAP traffic from the Dev App Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevAppSubnetAddressPrefix')]",
              "destinationPortRange": "389",
              "destinationAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 103
            }
          },
          {
            "name": "LDAP_Inbound_DevData",
            "properties": {
              "description": "This rule allows inbound LDAP traffic from the Dev Data Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevDataSubnetAddressPrefix')]",
              "destinationPortRange": "389",
              "destinationAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 104
            }
          },
          {
            "name": "LDAP_Inbound_BetaWeb",
            "properties": {
              "description": "This rule allows inbound LDAP traffic from the Beta Web Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('BetaWebSubnetAddressPrefix')]",
              "destinationPortRange": "389",
              "destinationAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 105
            }
          },
          {
            "name": "LDAP_Inbound_BetaApp",
            "properties": {
              "description": "This rule allows inbound LDAP traffic from the Beta App Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('BetaAppSubnetAddressPrefix')]",
              "destinationPortRange": "389",
              "destinationAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 106
            }
          },
          {
            "name": "LDAP_Inbound_BetaData",
            "properties": {
              "description": "This rule allows inbound LDAP traffic from the Beta Data Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('BetaDataSubnetAddressPrefix')]",
              "destinationPortRange": "389",
              "destinationAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 107
            }
          },
          {
            "name": "DNS_UDP_Inbound_All",
            "properties": {
              "description": "This rule allows inbound DNS traffic on UDP from all address ranges",
              "protocol": "Udp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "*",
              "destinationPortRange": "53",
              "destinationAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 108
            }
          },
          {
            "name": "DNS_TCP_Inbound_All",
            "properties": {
              "description": "This rule allows inbound DNS traffic on TCP from all address ranges",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "*",
              "destinationPortRange": "53",
              "destinationAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 109
            }
          },
          {
            "name": "RDP_Inbound_DevBetaMgmtSubnet",
            "properties": {
              "description": "This rule allows inbound RDP traffic from the Dev-Beta Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "3389",
              "destinationAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 110
            }
          },
          {
            "name": "LDAP_Inbound_DevBetaMgmtSubnet",
            "properties": {
              "description": "This rule allows inbound LDAP traffic from the Dev-Beta Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "389",
              "destinationAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 111
            }
          },
          {
            "name": "Deny_Inbound_All",
            "properties": {
              "description": "This rule denies all inbound traffic not otherwise allowed from all sources",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "*",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "access": "Deny",
              "direction": "Inbound",
              "priority": 199
            }
          },
          {
            "name": "RDP_Outbound_DevWeb",
            "properties": {
              "description": "This rule allows inbound RDP traffic to the Dev Web Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "3389",
              "destinationAddressPrefix": "[parameters('DevWebSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 201
            }
          },
          {
            "name": "RDP_Outbound_DevApp",
            "properties": {
              "description": "This rule allows inbound RDP traffic to the Dev App Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "3389",
              "destinationAddressPrefix": "[parameters('DevAppSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 202
            }
          },
          {
            "name": "RDP_Outbound_DevData",
            "properties": {
              "description": "This rule allows inbound RDP traffic to the Dev Data Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "3389",
              "destinationAddressPrefix": "[parameters('DevDataSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 203
            }
          },
          {
            "name": "RDP_Outbound_BetaWeb",
            "properties": {
              "description": "This rule allows inbound RDP traffic to the Beta Web Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "3389",
              "destinationAddressPrefix": "[parameters('BetaWebSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 204
            }
          },
          {
            "name": "RDP_Outbound_BetaApp",
            "properties": {
              "description": "This rule allows inbound RDP traffic to the Beta App Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "3389",
              "destinationAddressPrefix": "[parameters('BetaAppSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 205
            }
          },
          {
            "name": "RDP_Outbound_BetaData",
            "properties": {
              "description": "This rule allows inbound RDP traffic to the Beta Data Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "3389",
              "destinationAddressPrefix": "[parameters('BetaDataSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 206
            }
          },
          {
            "name": "HTTP_Outbound_Internet",
            "properties": {
              "description": "This rule allows all Outbound HTTP traffic to the Internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "80",
              "destinationAddressPrefix": "Internet",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 297
            }
          },
          {
            "name": "HTTPS_Outbound_Internet",
            "properties": {
              "description": "This rule allows all Outbound HTTPS traffic to the Internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "Internet",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 298
            }
          },
          {
            "name": "Deny_Outbound_All",
            "properties": {
              "description": "This rule denies all Outbound traffic not otherwise allowed to all destinations",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "*",
              "access": "Deny",
              "direction": "Inbound",
              "priority": 299
            }
          }
        ]
      }
    },
    //Dev Web security policies
    {
      "apiVersion": "2015-05-01-preview",
      "type": "Microsoft.Network/networkSecurityGroups",
      "name": "[parameters('DevWebNSGName')]",
      "location": "[parameters('customerLocation')]",
      "tags": {
        "displayName": "Dev Web Subnet NSG"
      },
      "properties": {
        "securityRules": [
          {
            "name": "HTTP_Inbound_PubSubnet",
            "properties": {
              "description": "This rule allows inbound HTTP traffic from the Public Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('PubSubnetAddressPrefix')]",
              "destinationPortRange": "80",
              "destinationAddressPrefix": "[parameters('DevWebSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 100
            }
          },
          {
            "name": "HTTPS_Inbound_PubSubnet",
            "properties": {
              "description": "This rule allows inbound HTTP traffic from the Public Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('PubSubnetAddressPrefix')]",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "[parameters('DevWebSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 101
            }
          },
          {
            "name": "RDP_Inbound_DevBetaMgmtSubnet",
            "properties": {
              "description": "This rule allows inbound RDP traffic from the Dev-Beta Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "3389",
              "destinationAddressPrefix": "[parameters('DevWebSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 102
            }
          },
          {
            "name": "Deny_Inbound_All",
            "properties": {
              "description": "This rule denies all inbound traffic not otherwise allowed from all sources",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "*",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "[parameters('DevWebSubnetAddressPrefix')]",
              "access": "Deny",
              "direction": "Inbound",
              "priority": 199
            }
          },
          {
            "name": "HTTP_Outbound_DevApp",
            "properties": {
              "description": "This rule allows outbound HTTP traffic to the Dev App Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevWebSubnetAddressPrefix')]",
              "destinationPortRange": "80",
              "destinationAddressPrefix": "[parameters('DevAppSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 201
            }
          },
          {
            "name": "HTTPS_Outbound_DevApp",
            "properties": {
              "description": "This rule allows outbound HTTPS traffic to the Dev App Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevWebSubnetAddressPrefix')]",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "[parameters('DevAppSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 202
            }
          },
          {
            "name": "LDAP_Outbound_DevBetaMgmt",
            "properties": {
              "description": "This rule allows outbound LDAP traffic to the Dev-Beta Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevWebSubnetAddressPrefix')]",
              "destinationPortRange": "389",
              "destinationAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 203
            }
          },
          {
            "name": "DNS_TCP_Outbound_DevBetaMgmt",
            "properties": {
              "description": "This rule allows outbound DNS traffic on TCP to the Dev-Beta Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevWebSubnetAddressPrefix')]",
              "destinationPortRange": "53",
              "destinationAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 204
            }
          },
          {
            "name": "DNS_UDP_Outbound_DevBetaMgmt",
            "properties": {
              "description": "This rule allows outbound DNS traffic on UDP to the Dev-Beta Mgmt Subnet",
              "protocol": "Udp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevWebSubnetAddressPrefix')]",
              "destinationPortRange": "53",
              "destinationAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 205
            }
          },
          {
            "name": "HTTP_Outbound_Internet",
            "properties": {
              "description": "This rule allows all Outbound HTTP traffic to the Internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevWebSubnetAddressPrefix')]",
              "destinationPortRange": "80",
              "destinationAddressPrefix": "Internet",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 297
            }
          },
          {
            "name": "HTTPS_Outbound_Internet",
            "properties": {
              "description": "This rule allows all Outbound HTTPS traffic to the Internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevWebSubnetAddressPrefix')]",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "Internet",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 298
            }
          },
          {
            "name": "Deny_Outbound_All",
            "properties": {
              "description": "This rule denies all Outbound traffic not otherwise allowed to all destinations",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevWebSubnetAddressPrefix')]",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "*",
              "access": "Deny",
              "direction": "Inbound",
              "priority": 299
            }
          }
        ]
      }
    },
    //Dev App security policies
    {
      "apiVersion": "2015-05-01-preview",
      "type": "Microsoft.Network/networkSecurityGroups",
      "name": "[parameters('DevAppNSGName')]",
      "location": "[parameters('customerLocation')]",
      "tags": {
        "displayName": "Dev App Subnet NSG"
      },
      "properties": {
        "securityRules": [
          {
            "name": "HTTP_Inbound_DevWebSubnet",
            "properties": {
              "description": "This rule allows inbound HTTP traffic from the Dev Web Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevWebSubnetAddressPrefix')]",
              "destinationPortRange": "80",
              "destinationAddressPrefix": "[parameters('DevAppSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 100
            }
          },
          {
            "name": "HTTPS_Inbound_DevWebSubnet",
            "properties": {
              "description": "This rule allows inbound HTTP traffic from the Dev Web Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevWebSubnetAddressPrefix')]",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "[parameters('DevAppSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 101
            }
          },
          {
            "name": "SQL_Inbound_DevData",
            "properties": {
              "description": "This rule allows Inbound SQL traffic to the Dev Data Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevDataSubnetAddressPrefix')]",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "[parameters('DevAppSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 102
            }
          },
          {
            "name": "RDP_Inbound_DevBetaMgmtSubnet",
            "properties": {
              "description": "This rule allows inbound RDP traffic from the Dev-Beta Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "3389",
              "destinationAddressPrefix": "[parameters('DevAppSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 103
            }
          },
          {
            "name": "Deny_Inbound_All",
            "properties": {
              "description": "This rule denies all inbound traffic not otherwise allowed from all sources",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "*",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "[parameters('DevAppSubnetAddressPrefix')]",
              "access": "Deny",
              "direction": "Inbound",
              "priority": 199
            }
          },
          {
            "name": "SQL_Outbound_DevData",
            "properties": {
              "description": "This rule allows outbound SQL traffic to the Dev Data Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevAppSubnetAddressPrefix')]",
              "destinationPortRange": "1433",
              "destinationAddressPrefix": "[parameters('DevDataSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 201
            }
          },
          {
            "name": "LDAP_Outbound_DevBetaMgmt",
            "properties": {
              "description": "This rule allows outbound LDAP traffic to the Dev-Beta Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevAppSubnetAddressPrefix')]",
              "destinationPortRange": "389",
              "destinationAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 202
            }
          },
          {
            "name": "DNS_TCP_Outbound_DevBetaMgmt",
            "properties": {
              "description": "This rule allows outbound DNS traffic on TCP to the Dev-Beta Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevAppSubnetAddressPrefix')]",
              "destinationPortRange": "53",
              "destinationAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 203
            }
          },
          {
            "name": "DNS_UDP_Outbound_DevBetaMgmt",
            "properties": {
              "description": "This rule allows outbound DNS traffic on UDP to the Dev-Beta Mgmt Subnet",
              "protocol": "Udp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevAppSubnetAddressPrefix')]",
              "destinationPortRange": "53",
              "destinationAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 204
            }
          },
          {
            "name": "HTTP_Outbound_Internet",
            "properties": {
              "description": "This rule allows all Outbound HTTP traffic to the Internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevAppSubnetAddressPrefix')]",
              "destinationPortRange": "80",
              "destinationAddressPrefix": "Internet",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 297
            }
          },
          {
            "name": "HTTPS_Outbound_Internet",
            "properties": {
              "description": "This rule allows all Outbound HTTPS traffic to the Internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevAppSubnetAddressPrefix')]",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "Internet",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 298
            }
          },
          {
            "name": "Deny_Outbound_All",
            "properties": {
              "description": "This rule denies all Outbound traffic not otherwise allowed to all destinations",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevAppSubnetAddressPrefix')]",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "*",
              "access": "Deny",
              "direction": "Inbound",
              "priority": 299
            }
          }
        ]
      }
    },
    //Dev Data security policies
    {
      "apiVersion": "2015-05-01-preview",
      "type": "Microsoft.Network/networkSecurityGroups",
      "name": "[parameters('DevDataNSGName')]",
      "location": "[parameters('customerLocation')]",
      "tags": {
        "displayName": "Dev Data Subnet NSG"
      },
      "properties": {
        "securityRules": [
          {
            "name": "SQL_Inbound_DevApp",
            "properties": {
              "description": "This rule allows inbound SQL traffic from the Dev App Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevAppSubnetAddressPrefix')]",
              "destinationPortRange": "1433",
              "destinationAddressPrefix": "[parameters('DevDataSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 100
            }
          },
          {
            "name": "RDP_Inbound_DevBetaMgmt",
            "properties": {
              "description": "This rule allows inbound RDP traffic from the Dev-Beta Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "3389",
              "destinationAddressPrefix": "[parameters('DevDataSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 101
            }
          },
          {
            "name": "Deny_Inbound_All",
            "properties": {
              "description": "This rule denies all inbound traffic not otherwise allowed from all sources",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "*",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "[parameters('DevDataSubnetAddressPrefix')]",
              "access": "Deny",
              "direction": "Inbound",
              "priority": 199
            }
          },
          {
            "name": "LDAP_Outbound_DevBetaMgmt",
            "properties": {
              "description": "This rule allows outbound LDAP traffic to the Dev-Beta Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevDataSubnetAddressPrefix')]",
              "destinationPortRange": "389",
              "destinationAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 201
            }
          },
          {
            "name": "DNS_TCP_Outbound_DevBetaMgmt",
            "properties": {
              "description": "This rule allows outbound DNS traffic on TCP to the Dev-Beta Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevDataSubnetAddressPrefix')]",
              "destinationPortRange": "53",
              "destinationAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 202
            }
          },
          {
            "name": "DNS_UDP_Outbound_DevBetaMgmt",
            "properties": {
              "description": "This rule allows outbound DNS traffic on UDP to the Dev-Beta Mgmt Subnet",
              "protocol": "Udp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevDataSubnetAddressPrefix')]",
              "destinationPortRange": "53",
              "destinationAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 203
            }
          },
          {
            "name": "HTTP_Outbound_Internet",
            "properties": {
              "description": "This rule allows all Outbound HTTP traffic to the Internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevDataSubnetAddressPrefix')]",
              "destinationPortRange": "80",
              "destinationAddressPrefix": "Internet",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 297
            }
          },
          {
            "name": "HTTPS_Outbound_Internet",
            "properties": {
              "description": "This rule allows all Outbound HTTPS traffic to the Internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevDataSubnetAddressPrefix')]",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "Internet",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 298
            }
          },
          {
            "name": "Deny_Outbound_All",
            "properties": {
              "description": "This rule denies all Outbound traffic not otherwise allowed to all destinations",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevDataSubnetAddressPrefix')]",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "*",
              "access": "Deny",
              "direction": "Inbound",
              "priority": 299
            }
          }
        ]
      }
    },
    //Beta Web security policies
    {
      "apiVersion": "2015-05-01-preview",
      "type": "Microsoft.Network/networkSecurityGroups",
      "name": "[parameters('BetaWebNSGName')]",
      "location": "[parameters('customerLocation')]",
      "tags": {
        "displayName": "Beta Web Subnet NSG"
      },
      "properties": {
        "securityRules": [
          {
            "name": "HTTP_Inbound_PubSubnet",
            "properties": {
              "description": "This rule allows inbound HTTP traffic from the Public Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('PubSubnetAddressPrefix')]",
              "destinationPortRange": "80",
              "destinationAddressPrefix": "[parameters('BetaWebSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 100
            }
          },
          {
            "name": "HTTPS_Inbound_PubSubnet",
            "properties": {
              "description": "This rule allows inbound HTTP traffic from the Public Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('PubSubnetAddressPrefix')]",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "[parameters('BetaWebSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 101
            }
          },
          {
            "name": "RDP_Inbound_DevBetaMgmtSubnet",
            "properties": {
              "description": "This rule allows inbound RDP traffic from the Dev-Beta Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "3389",
              "destinationAddressPrefix": "[parameters('BetaWebSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 102
            }
          },
          {
            "name": "Deny_Inbound_All",
            "properties": {
              "description": "This rule denies all inbound traffic not otherwise allowed from all sources",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "*",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "[parameters('BetaWebSubnetAddressPrefix')]",
              "access": "Deny",
              "direction": "Inbound",
              "priority": 199
            }
          },
          {
            "name": "HTTP_Outbound_BetaApp",
            "properties": {
              "description": "This rule allows outbound HTTP traffic to the Beta App Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('BetaWebSubnetAddressPrefix')]",
              "destinationPortRange": "80",
              "destinationAddressPrefix": "[parameters('BetaAppSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 201
            }
          },
          {
            "name": "HTTPS_Outbound_BetaApp",
            "properties": {
              "description": "This rule allows outbound HTTPS traffic to the Dev App Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('BetaWebSubnetAddressPrefix')]",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "[parameters('BetaAppSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 202
            }
          },
          {
            "name": "LDAP_Outbound_DevBetaMgmt",
            "properties": {
              "description": "This rule allows outbound LDAP traffic to the Dev-Beta Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('BetaWebSubnetAddressPrefix')]",
              "destinationPortRange": "389",
              "destinationAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 203
            }
          },
          {
            "name": "DNS_TCP_Outbound_DevBetaMgmt",
            "properties": {
              "description": "This rule allows outbound DNS traffic on TCP to the Dev-Beta Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('BetaWebSubnetAddressPrefix')]",
              "destinationPortRange": "53",
              "destinationAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 204
            }
          },
          {
            "name": "DNS_UDP_Outbound_DevBetaMgmt",
            "properties": {
              "description": "This rule allows outbound DNS traffic on UDP to the Dev-Beta Mgmt Subnet",
              "protocol": "Udp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('BetaWebSubnetAddressPrefix')]",
              "destinationPortRange": "53",
              "destinationAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 205
            }
          },
          {
            "name": "HTTP_Outbound_Internet",
            "properties": {
              "description": "This rule allows all Outbound HTTP traffic to the Internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('BetaWebSubnetAddressPrefix')]",
              "destinationPortRange": "80",
              "destinationAddressPrefix": "Internet",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 297
            }
          },
          {
            "name": "HTTPS_Outbound_Internet",
            "properties": {
              "description": "This rule allows all Outbound HTTPS traffic to the Internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('BetaWebSubnetAddressPrefix')]",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "Internet",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 298
            }
          },
          {
            "name": "Deny_Outbound_All",
            "properties": {
              "description": "This rule denies all Outbound traffic not otherwise allowed to all destinations",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('BetaWebSubnetAddressPrefix')]",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "*",
              "access": "Deny",
              "direction": "Inbound",
              "priority": 299
            }
          }
        ]
      }
    },
    //Beta App security policies
    {
      "apiVersion": "2015-05-01-preview",
      "type": "Microsoft.Network/networkSecurityGroups",
      "name": "[parameters('BetaAppNSGName')]",
      "location": "[parameters('customerLocation')]",
      "tags": {
        "displayName": "Beta App Subnet NSG"
      },
      "properties": {
        "securityRules": [
          {
            "name": "HTTP_Inbound_BetaWebSubnet",
            "properties": {
              "description": "This rule allows inbound HTTP traffic from the Beta Web Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('BetaWebSubnetAddressPrefix')]",
              "destinationPortRange": "80",
              "destinationAddressPrefix": "[parameters('BetaAppSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 100
            }
          },
          {
            "name": "HTTPS_Inbound_BetaWebSubnet",
            "properties": {
              "description": "This rule allows inbound HTTP traffic from the Beta Web Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('BetaWebSubnetAddressPrefix')]",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "[parameters('BetaAppSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 101
            }
          },
          {
            "name": "SQL_Inbound_BetaData",
            "properties": {
              "description": "This rule allows Inbound SQL traffic to the Beta Data Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('BetaDataSubnetAddressPrefix')]",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "[parameters('BetaAppSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 102
            }
          },
          {
            "name": "RDP_Inbound_DevBetaMgmtSubnet",
            "properties": {
              "description": "This rule allows inbound RDP traffic from the Dev-Beta Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "3389",
              "destinationAddressPrefix": "[parameters('BetaAppSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 103
            }
          },
          {
            "name": "Deny_Inbound_All",
            "properties": {
              "description": "This rule denies all inbound traffic not otherwise allowed from all sources",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "*",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "[parameters('BetaAppSubnetAddressPrefix')]",
              "access": "Deny",
              "direction": "Inbound",
              "priority": 199
            }
          },
          {
            "name": "SQL_Outbound_BetaData",
            "properties": {
              "description": "This rule allows outbound SQL traffic to the Beta Data Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('BetaAppSubnetAddressPrefix')]",
              "destinationPortRange": "1433",
              "destinationAddressPrefix": "[parameters('BetaDataSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 201
            }
          },
          {
            "name": "LDAP_Outbound_DevBetaMgmt",
            "properties": {
              "description": "This rule allows outbound LDAP traffic to the Dev-Beta Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('BetaAppSubnetAddressPrefix')]",
              "destinationPortRange": "389",
              "destinationAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 202
            }
          },
          {
            "name": "DNS_TCP_Outbound_DevBetaMgmt",
            "properties": {
              "description": "This rule allows outbound DNS traffic on TCP to the Dev-Beta Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('BetaAppSubnetAddressPrefix')]",
              "destinationPortRange": "53",
              "destinationAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 203
            }
          },
          {
            "name": "DNS_UDP_Outbound_DevBetaMgmt",
            "properties": {
              "description": "This rule allows outbound DNS traffic on UDP to the Dev-Beta Mgmt Subnet",
              "protocol": "Udp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('BetaAppSubnetAddressPrefix')]",
              "destinationPortRange": "53",
              "destinationAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 204
            }
          },
          {
            "name": "HTTP_Outbound_Internet",
            "properties": {
              "description": "This rule allows all Outbound HTTP traffic to the Internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('BetaAppSubnetAddressPrefix')]",
              "destinationPortRange": "80",
              "destinationAddressPrefix": "Internet",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 297
            }
          },
          {
            "name": "HTTPS_Outbound_Internet",
            "properties": {
              "description": "This rule allows all Outbound HTTPS traffic to the Internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('BetaAppSubnetAddressPrefix')]",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "Internet",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 298
            }
          },
          {
            "name": "Deny_Outbound_All",
            "properties": {
              "description": "This rule denies all Outbound traffic not otherwise allowed to all destinations",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('BetaAppSubnetAddressPrefix')]",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "*",
              "access": "Deny",
              "direction": "Inbound",
              "priority": 299
            }
          }
        ]
      }
    },
    //Beta Data security policies
    {
      "apiVersion": "2015-05-01-preview",
      "type": "Microsoft.Network/networkSecurityGroups",
      "name": "[parameters('BetaDataNSGName')]",
      "location": "[parameters('customerLocation')]",
      "tags": {
        "displayName": "Beta Data Subnet NSG"
      },
      "properties": {
        "securityRules": [
          {
            "name": "SQL_Inbound_BetaApp",
            "properties": {
              "description": "This rule allows inbound SQL traffic from the Beta App Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('BetaAppSubnetAddressPrefix')]",
              "destinationPortRange": "1433",
              "destinationAddressPrefix": "[parameters('BetaDataSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 100
            }
          },
          {
            "name": "RDP_Inbound_DevBetaMgmt",
            "properties": {
              "description": "This rule allows inbound RDP traffic from the Dev-Beta Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "3389",
              "destinationAddressPrefix": "[parameters('BetaDataSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 101
            }
          },
          {
            "name": "Deny_Inbound_All",
            "properties": {
              "description": "This rule denies all inbound traffic not otherwise allowed from all sources",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "*",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "[parameters('BetaDataSubnetAddressPrefix')]",
              "access": "Deny",
              "direction": "Inbound",
              "priority": 199
            }
          },
          {
            "name": "LDAP_Outbound_DevBetaMgmt",
            "properties": {
              "description": "This rule allows outbound LDAP traffic to the Dev-Beta Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('BetaDataSubnetAddressPrefix')]",
              "destinationPortRange": "389",
              "destinationAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 201
            }
          },
          {
            "name": "DNS_TCP_Outbound_DevBetaMgmt",
            "properties": {
              "description": "This rule allows outbound DNS traffic on TCP to the Dev-Beta Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('BetaDataSubnetAddressPrefix')]",
              "destinationPortRange": "53",
              "destinationAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 202
            }
          },
          {
            "name": "DNS_UDP_Outbound_DevBetaMgmt",
            "properties": {
              "description": "This rule allows outbound DNS traffic on UDP to the Dev-Beta Mgmt Subnet",
              "protocol": "Udp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('BetaDataSubnetAddressPrefix')]",
              "destinationPortRange": "53",
              "destinationAddressPrefix": "[parameters('DevBetaMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 203
            }
          },
          {
            "name": "HTTP_Outbound_Internet",
            "properties": {
              "description": "This rule allows all Outbound HTTP traffic to the Internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('BetaDataSubnetAddressPrefix')]",
              "destinationPortRange": "80",
              "destinationAddressPrefix": "Internet",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 297
            }
          },
          {
            "name": "HTTPS_Outbound_Internet",
            "properties": {
              "description": "This rule allows all Outbound HTTPS traffic to the Internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('BetaDataSubnetAddressPrefix')]",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "Internet",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 298
            }
          },
          {
            "name": "Deny_Outbound_All",
            "properties": {
              "description": "This rule denies all Outbound traffic not otherwise allowed to all destinations",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('BetaDataSubnetAddressPrefix')]",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "*",
              "access": "Deny",
              "direction": "Inbound",
              "priority": 299
            }
          }
        ]
      }
    },
    //StgProd Mgmt security policies
    {
      "apiVersion": "2015-05-01-preview",
      "type": "Microsoft.Network/networkSecurityGroups",
      "name": "[parameters('StgProdMgmtNSGName')]",
      "location": "[parameters('customerLocation')]",
      "tags": {
        "displayName": "Stg-Prod Mgmt Subnet NSG"
      },
      "properties": {
        "securityRules": [
          {
            "name": "HTTPS_Inbound_Internet",
            "properties": {
              "description": "This rule allows inbound HTTPS traffic from the Internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "Internet",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 100
            }
          },
          {
            "name": "RDP_Inbound_Internet",
            "properties": {
              "description": "This rule allows inbound RDP traffic from the Stg-Prod Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "Internet",
              "destinationPortRange": "3389",
              "destinationAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 101
            }
          },
          {
            "name": "LDAP_Inbound_StgWeb",
            "properties": {
              "description": "This rule allows inbound LDAP traffic from the Stg Web Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgWebSubnetAddressPrefix')]",
              "destinationPortRange": "389",
              "destinationAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 102
            }
          },
          {
            "name": "LDAP_Inbound_StgApp",
            "properties": {
              "description": "This rule allows inbound LDAP traffic from the Stg App Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgAppSubnetAddressPrefix')]",
              "destinationPortRange": "389",
              "destinationAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 103
            }
          },
          {
            "name": "LDAP_Inbound_StgData",
            "properties": {
              "description": "This rule allows inbound LDAP traffic from the Stg Data Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgDataSubnetAddressPrefix')]",
              "destinationPortRange": "389",
              "destinationAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 104
            }
          },
          {
            "name": "LDAP_Inbound_ProdWeb",
            "properties": {
              "description": "This rule allows inbound LDAP traffic from the Prod Web Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('ProdWebSubnetAddressPrefix')]",
              "destinationPortRange": "389",
              "destinationAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 105
            }
          },
          {
            "name": "LDAP_Inbound_ProdApp",
            "properties": {
              "description": "This rule allows inbound LDAP traffic from the Prod App Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('ProdAppSubnetAddressPrefix')]",
              "destinationPortRange": "389",
              "destinationAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 106
            }
          },
          {
            "name": "LDAP_Inbound_ProdData",
            "properties": {
              "description": "This rule allows inbound LDAP traffic from the Prod Data Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('ProdDataSubnetAddressPrefix')]",
              "destinationPortRange": "389",
              "destinationAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 107
            }
          },
          {
            "name": "DNS_UDP_Inbound_All",
            "properties": {
              "description": "This rule allows inbound DNS traffic on UDP from all address ranges",
              "protocol": "Udp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "*",
              "destinationPortRange": "53",
              "destinationAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 108
            }
          },
          {
            "name": "DNS_TCP_Inbound_All",
            "properties": {
              "description": "This rule allows inbound DNS traffic on TCP from all address ranges",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "*",
              "destinationPortRange": "53",
              "destinationAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 109
            }
          },
          {
            "name": "RDP_Inbound_StgProdMgmtSubnet",
            "properties": {
              "description": "This rule allows inbound RDP traffic from the Stg-Prod Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "3389",
              "destinationAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 110
            }
          },
          {
            "name": "LDAP_Inbound_StgProdMgmtSubnet",
            "properties": {
              "description": "This rule allows inbound LDAP traffic from the Stg-Prod Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "389",
              "destinationAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 111
            }
          },
          {
            "name": "Deny_Inbound_All",
            "properties": {
              "description": "This rule denies all inbound traffic not otherwise allowed from all sources",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "*",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "access": "Deny",
              "direction": "Inbound",
              "priority": 199
            }
          },
          {
            "name": "RDP_Outbound_StgWeb",
            "properties": {
              "description": "This rule allows inbound RDP traffic to the Stg Web Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "3389",
              "destinationAddressPrefix": "[parameters('StgWebSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 201
            }
          },
          {
            "name": "RDP_Outbound_StgApp",
            "properties": {
              "description": "This rule allows inbound RDP traffic to the Stg App Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "3389",
              "destinationAddressPrefix": "[parameters('StgAppSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 202
            }
          },
          {
            "name": "RDP_Outbound_StgData",
            "properties": {
              "description": "This rule allows inbound RDP traffic to the Stg Data Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "3389",
              "destinationAddressPrefix": "[parameters('StgDataSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 203
            }
          },
          {
            "name": "RDP_Outbound_ProdWeb",
            "properties": {
              "description": "This rule allows inbound RDP traffic to the Prod Web Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "3389",
              "destinationAddressPrefix": "[parameters('ProdWebSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 204
            }
          },
          {
            "name": "RDP_Outbound_ProdApp",
            "properties": {
              "description": "This rule allows inbound RDP traffic to the Prod App Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "3389",
              "destinationAddressPrefix": "[parameters('ProdAppSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 205
            }
          },
          {
            "name": "RDP_Outbound_ProdData",
            "properties": {
              "description": "This rule allows inbound RDP traffic to the Prod Data Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "3389",
              "destinationAddressPrefix": "[parameters('ProdDataSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 206
            }
          },
          {
            "name": "HTTP_Outbound_Internet",
            "properties": {
              "description": "This rule allows all Outbound HTTP traffic to the Internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "80",
              "destinationAddressPrefix": "Internet",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 297
            }
          },
          {
            "name": "HTTPS_Outbound_Internet",
            "properties": {
              "description": "This rule allows all Outbound HTTPS traffic to the Internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "Internet",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 298
            }
          },
          {
            "name": "Deny_Outbound_All",
            "properties": {
              "description": "This rule denies all Outbound traffic not otherwise allowed to all destinations",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "*",
              "access": "Deny",
              "direction": "Inbound",
              "priority": 299
            }
          }
        ]
      }
    },
    //Stg Web security policies
    {
      "apiVersion": "2015-05-01-preview",
      "type": "Microsoft.Network/networkSecurityGroups",
      "name": "[parameters('StgWebNSGName')]",
      "location": "[parameters('customerLocation')]",
      "tags": {
        "displayName": "Stg Web Subnet NSG"
      },
      "properties": {
        "securityRules": [
          {
            "name": "HTTP_Inbound_PubSubnet",
            "properties": {
              "description": "This rule allows inbound HTTP traffic from the Public Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('PubSubnetAddressPrefix')]",
              "destinationPortRange": "80",
              "destinationAddressPrefix": "[parameters('StgWebSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 100
            }
          },
          {
            "name": "HTTPS_Inbound_PubSubnet",
            "properties": {
              "description": "This rule allows inbound HTTP traffic from the Public Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('PubSubnetAddressPrefix')]",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "[parameters('StgWebSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 101
            }
          },
          {
            "name": "RDP_Inbound_StgProdMgmtSubnet",
            "properties": {
              "description": "This rule allows inbound RDP traffic from the Stg-Prod Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "3389",
              "destinationAddressPrefix": "[parameters('StgWebSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 102
            }
          },
          {
            "name": "Deny_Inbound_All",
            "properties": {
              "description": "This rule denies all inbound traffic not otherwise allowed from all sources",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "*",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "[parameters('StgWebSubnetAddressPrefix')]",
              "access": "Deny",
              "direction": "Inbound",
              "priority": 199
            }
          },
          {
            "name": "HTTP_Outbound_StgApp",
            "properties": {
              "description": "This rule allows outbound HTTP traffic to the Stg App Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgWebSubnetAddressPrefix')]",
              "destinationPortRange": "80",
              "destinationAddressPrefix": "[parameters('StgAppSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 201
            }
          },
          {
            "name": "HTTPS_Outbound_StgApp",
            "properties": {
              "description": "This rule allows outbound HTTPS traffic to the Stg App Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgWebSubnetAddressPrefix')]",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "[parameters('StgAppSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 202
            }
          },
          {
            "name": "LDAP_Outbound_StgProdMgmt",
            "properties": {
              "description": "This rule allows outbound LDAP traffic to the StgProd Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgWebSubnetAddressPrefix')]",
              "destinationPortRange": "389",
              "destinationAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 203
            }
          },
          {
            "name": "DNS_TCP_Outbound_StgProdMgmt",
            "properties": {
              "description": "This rule allows outbound DNS traffic on TCP to the Stg-Prod Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgWebSubnetAddressPrefix')]",
              "destinationPortRange": "53",
              "destinationAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 204
            }
          },
          {
            "name": "DNS_UDP_Outbound_StgProdMgmt",
            "properties": {
              "description": "This rule allows outbound DNS traffic on UDP to the Stg-Prod Mgmt Subnet",
              "protocol": "Udp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgWebSubnetAddressPrefix')]",
              "destinationPortRange": "53",
              "destinationAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 205
            }
          },
          {
            "name": "HTTP_Outbound_Internet",
            "properties": {
              "description": "This rule allows all Outbound HTTP traffic to the Internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgWebSubnetAddressPrefix')]",
              "destinationPortRange": "80",
              "destinationAddressPrefix": "Internet",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 297
            }
          },
          {
            "name": "HTTPS_Outbound_Internet",
            "properties": {
              "description": "This rule allows all Outbound HTTPS traffic to the Internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgWebSubnetAddressPrefix')]",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "Internet",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 298
            }
          },
          {
            "name": "Deny_Outbound_All",
            "properties": {
              "description": "This rule denies all Outbound traffic not otherwise allowed to all destinations",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgWebSubnetAddressPrefix')]",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "*",
              "access": "Deny",
              "direction": "Inbound",
              "priority": 299
            }
          }
        ]
      }
    },
    //Stg App security policies
    {
      "apiVersion": "2015-05-01-preview",
      "type": "Microsoft.Network/networkSecurityGroups",
      "name": "[parameters('StgAppNSGName')]",
      "location": "[parameters('customerLocation')]",
      "tags": {
        "displayName": "Stg App Subnet NSG"
      },
      "properties": {
        "securityRules": [
          {
            "name": "HTTP_Inbound_StgWebSubnet",
            "properties": {
              "description": "This rule allows inbound HTTP traffic from the Stg Web Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgWebSubnetAddressPrefix')]",
              "destinationPortRange": "80",
              "destinationAddressPrefix": "[parameters('StgAppSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 100
            }
          },
          {
            "name": "HTTPS_Inbound_StgWebSubnet",
            "properties": {
              "description": "This rule allows inbound HTTP traffic from the Stg Web Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgWebSubnetAddressPrefix')]",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "[parameters('StgAppSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 101
            }
          },
          {
            "name": "SQL_Inbound_StgData",
            "properties": {
              "description": "This rule allows Inbound SQL traffic to the Stg Data Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgDataSubnetAddressPrefix')]",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "[parameters('StgAppSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 102
            }
          },
          {
            "name": "RDP_Inbound_StgProdMgmtSubnet",
            "properties": {
              "description": "This rule allows inbound RDP traffic from the Stg-Prod Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "3389",
              "destinationAddressPrefix": "[parameters('StgAppSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 103
            }
          },
          {
            "name": "Deny_Inbound_All",
            "properties": {
              "description": "This rule denies all inbound traffic not otherwise allowed from all sources",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "*",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "[parameters('StgAppSubnetAddressPrefix')]",
              "access": "Deny",
              "direction": "Inbound",
              "priority": 199
            }
          },
          {
            "name": "SQL_Outbound_StgData",
            "properties": {
              "description": "This rule allows outbound SQL traffic to the Stg Data Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgAppSubnetAddressPrefix')]",
              "destinationPortRange": "1433",
              "destinationAddressPrefix": "[parameters('StgDataSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 201
            }
          },
          {
            "name": "LDAP_Outbound_StgProdMgmt",
            "properties": {
              "description": "This rule allows outbound LDAP traffic to the Stg-Prod Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgAppSubnetAddressPrefix')]",
              "destinationPortRange": "389",
              "destinationAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 202
            }
          },
          {
            "name": "DNS_TCP_Outbound_StgProdMgmt",
            "properties": {
              "description": "This rule allows outbound DNS traffic on TCP to the Stg-Prod Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgAppSubnetAddressPrefix')]",
              "destinationPortRange": "53",
              "destinationAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 203
            }
          },
          {
            "name": "DNS_UDP_Outbound_StgProdMgmt",
            "properties": {
              "description": "This rule allows outbound DNS traffic on UDP to the Stg-Prod Mgmt Subnet",
              "protocol": "Udp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgAppSubnetAddressPrefix')]",
              "destinationPortRange": "53",
              "destinationAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 204
            }
          },
          {
            "name": "HTTP_Outbound_Internet",
            "properties": {
              "description": "This rule allows all Outbound HTTP traffic to the Internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgAppSubnetAddressPrefix')]",
              "destinationPortRange": "80",
              "destinationAddressPrefix": "Internet",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 297
            }
          },
          {
            "name": "HTTPS_Outbound_Internet",
            "properties": {
              "description": "This rule allows all Outbound HTTPS traffic to the Internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgAppSubnetAddressPrefix')]",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "Internet",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 298
            }
          },
          {
            "name": "Deny_Outbound_All",
            "properties": {
              "description": "This rule denies all Outbound traffic not otherwise allowed to all destinations",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgAppSubnetAddressPrefix')]",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "*",
              "access": "Deny",
              "direction": "Inbound",
              "priority": 299
            }
          }
        ]
      }
    },
    //Stg Data security policies
    {
      "apiVersion": "2015-05-01-preview",
      "type": "Microsoft.Network/networkSecurityGroups",
      "name": "[parameters('StgDataNSGName')]",
      "location": "[parameters('customerLocation')]",
      "tags": {
        "displayName": "Stg Data Subnet NSG"
      },
      "properties": {
        "securityRules": [
          {
            "name": "SQL_Inbound_StgApp",
            "properties": {
              "description": "This rule allows inbound SQL traffic from the Stg App Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgAppSubnetAddressPrefix')]",
              "destinationPortRange": "1433",
              "destinationAddressPrefix": "[parameters('StgDataSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 100
            }
          },
          {
            "name": "RDP_Inbound_StgProdMgmt",
            "properties": {
              "description": "This rule allows inbound RDP traffic from the Stg-Prod Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "3389",
              "destinationAddressPrefix": "[parameters('StgDataSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 101
            }
          },
          {
            "name": "Deny_Inbound_All",
            "properties": {
              "description": "This rule denies all inbound traffic not otherwise allowed from all sources",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "*",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "[parameters('StgDataSubnetAddressPrefix')]",
              "access": "Deny",
              "direction": "Inbound",
              "priority": 199
            }
          },
          {
            "name": "LDAP_Outbound_StgProdMgmt",
            "properties": {
              "description": "This rule allows outbound LDAP traffic to the Stg-Prod Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgDataSubnetAddressPrefix')]",
              "destinationPortRange": "389",
              "destinationAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 201
            }
          },
          {
            "name": "DNS_TCP_Outbound_StgProdMgmt",
            "properties": {
              "description": "This rule allows outbound DNS traffic on TCP to the Stg-Prod Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgDataSubnetAddressPrefix')]",
              "destinationPortRange": "53",
              "destinationAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 202
            }
          },
          {
            "name": "DNS_UDP_Outbound_StgProdMgmt",
            "properties": {
              "description": "This rule allows outbound DNS traffic on UDP to the Stg-Prod Mgmt Subnet",
              "protocol": "Udp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgDataSubnetAddressPrefix')]",
              "destinationPortRange": "53",
              "destinationAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 203
            }
          },
          {
            "name": "HTTP_Outbound_Internet",
            "properties": {
              "description": "This rule allows all Outbound HTTP traffic to the Internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgDataSubnetAddressPrefix')]",
              "destinationPortRange": "80",
              "destinationAddressPrefix": "Internet",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 297
            }
          },
          {
            "name": "HTTPS_Outbound_Internet",
            "properties": {
              "description": "This rule allows all Outbound HTTPS traffic to the Internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgDataSubnetAddressPrefix')]",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "Internet",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 298
            }
          },
          {
            "name": "Deny_Outbound_All",
            "properties": {
              "description": "This rule denies all Outbound traffic not otherwise allowed to all destinations",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgDataSubnetAddressPrefix')]",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "*",
              "access": "Deny",
              "direction": "Inbound",
              "priority": 299
            }
          }
        ]
      }
    },
    //Prod Web security policies
    {
      "apiVersion": "2015-05-01-preview",
      "type": "Microsoft.Network/networkSecurityGroups",
      "name": "[parameters('ProdWebNSGName')]",
      "location": "[parameters('customerLocation')]",
      "tags": {
        "displayName": "Prod Web Subnet NSG"
      },
      "properties": {
        "securityRules": [
          {
            "name": "HTTP_Inbound_PubSubnet",
            "properties": {
              "description": "This rule allows inbound HTTP traffic from the Public Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('PubSubnetAddressPrefix')]",
              "destinationPortRange": "80",
              "destinationAddressPrefix": "[parameters('ProdWebSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 100
            }
          },
          {
            "name": "HTTPS_Inbound_PubSubnet",
            "properties": {
              "description": "This rule allows inbound HTTP traffic from the Public Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('PubSubnetAddressPrefix')]",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "[parameters('ProdWebSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 101
            }
          },
          {
            "name": "RDP_Inbound_StgProdMgmtSubnet",
            "properties": {
              "description": "This rule allows inbound RDP traffic from the Stg-Prod Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "3389",
              "destinationAddressPrefix": "[parameters('ProdWebSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 102
            }
          },
          {
            "name": "Deny_Inbound_All",
            "properties": {
              "description": "This rule denies all inbound traffic not otherwise allowed from all sources",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "*",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "[parameters('ProdWebSubnetAddressPrefix')]",
              "access": "Deny",
              "direction": "Inbound",
              "priority": 199
            }
          },
          {
            "name": "HTTP_Outbound_ProdApp",
            "properties": {
              "description": "This rule allows outbound HTTP traffic to the Prod App Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('ProdWebSubnetAddressPrefix')]",
              "destinationPortRange": "80",
              "destinationAddressPrefix": "[parameters('ProdAppSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 201
            }
          },
          {
            "name": "HTTPS_Outbound_ProdApp",
            "properties": {
              "description": "This rule allows outbound HTTPS traffic to the Prod App Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('ProdWebSubnetAddressPrefix')]",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "[parameters('ProdAppSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 202
            }
          },
          {
            "name": "LDAP_Outbound_StgProdMgmt",
            "properties": {
              "description": "This rule allows outbound LDAP traffic to the StgProd Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('ProdWebSubnetAddressPrefix')]",
              "destinationPortRange": "389",
              "destinationAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 203
            }
          },
          {
            "name": "DNS_TCP_Outbound_StgProdMgmt",
            "properties": {
              "description": "This rule allows outbound DNS traffic on TCP to the Stg-Prod Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('ProdWebSubnetAddressPrefix')]",
              "destinationPortRange": "53",
              "destinationAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 204
            }
          },
          {
            "name": "DNS_UDP_Outbound_StgProdMgmt",
            "properties": {
              "description": "This rule allows outbound DNS traffic on UDP to the Stg-Prod Mgmt Subnet",
              "protocol": "Udp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('ProdWebSubnetAddressPrefix')]",
              "destinationPortRange": "53",
              "destinationAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 205
            }
          },
          {
            "name": "HTTP_Outbound_Internet",
            "properties": {
              "description": "This rule allows all Outbound HTTP traffic to the Internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('ProdWebSubnetAddressPrefix')]",
              "destinationPortRange": "80",
              "destinationAddressPrefix": "Internet",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 297
            }
          },
          {
            "name": "HTTPS_Outbound_Internet",
            "properties": {
              "description": "This rule allows all Outbound HTTPS traffic to the Internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('ProdWebSubnetAddressPrefix')]",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "Internet",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 298
            }
          },
          {
            "name": "Deny_Outbound_All",
            "properties": {
              "description": "This rule denies all Outbound traffic not otherwise allowed to all destinations",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('ProdWebSubnetAddressPrefix')]",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "*",
              "access": "Deny",
              "direction": "Inbound",
              "priority": 299
            }
          }
        ]
      }
    },
    //Prod App security policies
    {
      "apiVersion": "2015-05-01-preview",
      "type": "Microsoft.Network/networkSecurityGroups",
      "name": "[parameters('ProdAppNSGName')]",
      "location": "[parameters('customerLocation')]",
      "tags": {
        "displayName": "Prod App Subnet NSG"
      },
      "properties": {
        "securityRules": [
          {
            "name": "HTTP_Inbound_ProdWebSubnet",
            "properties": {
              "description": "This rule allows inbound HTTP traffic from the Prod Web Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('ProdWebSubnetAddressPrefix')]",
              "destinationPortRange": "80",
              "destinationAddressPrefix": "[parameters('ProdAppSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 100
            }
          },
          {
            "name": "HTTPS_Inbound_ProdWebSubnet",
            "properties": {
              "description": "This rule allows inbound HTTP traffic from the Prod Web Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('ProdWebSubnetAddressPrefix')]",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "[parameters('ProdAppSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 101
            }
          },
          {
            "name": "SQL_Inbound_Prodata",
            "properties": {
              "description": "This rule allows Inbound SQL traffic to the Prod Data Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('ProdDataSubnetAddressPrefix')]",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "[parameters('ProdAppSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 102
            }
          },
          {
            "name": "RDP_Inbound_StgProdMgmtSubnet",
            "properties": {
              "description": "This rule allows inbound RDP traffic from the Stg-Prod Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "3389",
              "destinationAddressPrefix": "[parameters('ProdAppSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 103
            }
          },
          {
            "name": "Deny_Inbound_All",
            "properties": {
              "description": "This rule denies all inbound traffic not otherwise allowed from all sources",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "*",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "[parameters('ProdAppSubnetAddressPrefix')]",
              "access": "Deny",
              "direction": "Inbound",
              "priority": 199
            }
          },
          {
            "name": "SQL_Outbound_ProdData",
            "properties": {
              "description": "This rule allows outbound SQL traffic to the Prod Data Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('ProdAppSubnetAddressPrefix')]",
              "destinationPortRange": "1433",
              "destinationAddressPrefix": "[parameters('ProdDataSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 201
            }
          },
          {
            "name": "LDAP_Outbound_StgProdMgmt",
            "properties": {
              "description": "This rule allows outbound LDAP traffic to the Stg-Prod Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('ProdAppSubnetAddressPrefix')]",
              "destinationPortRange": "389",
              "destinationAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 202
            }
          },
          {
            "name": "DNS_TCP_Outbound_StgProdMgmt",
            "properties": {
              "description": "This rule allows outbound DNS traffic on TCP to the Stg-Prod Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('ProdAppSubnetAddressPrefix')]",
              "destinationPortRange": "53",
              "destinationAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 203
            }
          },
          {
            "name": "DNS_UDP_Outbound_StgProdMgmt",
            "properties": {
              "description": "This rule allows outbound DNS traffic on UDP to the Stg-Prod Mgmt Subnet",
              "protocol": "Udp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('ProdAppSubnetAddressPrefix')]",
              "destinationPortRange": "53",
              "destinationAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 204
            }
          },
          {
            "name": "HTTP_Outbound_Internet",
            "properties": {
              "description": "This rule allows all Outbound HTTP traffic to the Internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('ProdAppSubnetAddressPrefix')]",
              "destinationPortRange": "80",
              "destinationAddressPrefix": "Internet",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 297
            }
          },
          {
            "name": "HTTPS_Outbound_Internet",
            "properties": {
              "description": "This rule allows all Outbound HTTPS traffic to the Internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('ProdAppSubnetAddressPrefix')]",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "Internet",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 298
            }
          },
          {
            "name": "Deny_Outbound_All",
            "properties": {
              "description": "This rule denies all Outbound traffic not otherwise allowed to all destinations",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('ProdAppSubnetAddressPrefix')]",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "*",
              "access": "Deny",
              "direction": "Inbound",
              "priority": 299
            }
          }
        ]
      }
    },
    //Prod Data security policies
    {
      "apiVersion": "2015-05-01-preview",
      "type": "Microsoft.Network/networkSecurityGroups",
      "name": "[parameters('ProdDataNSGName')]",
      "location": "[parameters('customerLocation')]",
      "tags": {
        "displayName": "Prod Data Subnet NSG"
      },
      "properties": {
        "securityRules": [
          {
            "name": "SQL_Inbound_ProdApp",
            "properties": {
              "description": "This rule allows inbound SQL traffic from the Prod App Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('ProdAppSubnetAddressPrefix')]",
              "destinationPortRange": "1433",
              "destinationAddressPrefix": "[parameters('ProdDataSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 100
            }
          },
          {
            "name": "RDP_Inbound_StgProdMgmt",
            "properties": {
              "description": "This rule allows inbound RDP traffic from the Stg-Prod Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "destinationPortRange": "3389",
              "destinationAddressPrefix": "[parameters('ProdDataSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 101
            }
          },
          {
            "name": "Deny_Inbound_All",
            "properties": {
              "description": "This rule denies all inbound traffic not otherwise allowed from all sources",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "*",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "[parameters('ProdDataSubnetAddressPrefix')]",
              "access": "Deny",
              "direction": "Inbound",
              "priority": 199
            }
          },
          {
            "name": "LDAP_Outbound_StgProdMgmt",
            "properties": {
              "description": "This rule allows outbound LDAP traffic to the Stg-Prod Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('ProdDataSubnetAddressPrefix')]",
              "destinationPortRange": "389",
              "destinationAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 201
            }
          },
          {
            "name": "DNS_TCP_Outbound_StgProdMgmt",
            "properties": {
              "description": "This rule allows outbound DNS traffic on TCP to the Stg-Prod Mgmt Subnet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('ProdDataSubnetAddressPrefix')]",
              "destinationPortRange": "53",
              "destinationAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 202
            }
          },
          {
            "name": "DNS_UDP_Outbound_StgProdMgmt",
            "properties": {
              "description": "This rule allows outbound DNS traffic on UDP to the Stg-Prod Mgmt Subnet",
              "protocol": "Udp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('ProdDataSubnetAddressPrefix')]",
              "destinationPortRange": "53",
              "destinationAddressPrefix": "[parameters('StgProdMgmtSubnetAddressPrefix')]",
              "access": "Allow",
              "direction": "Outbound",
              "priority": 203
            }
          },
          {
            "name": "HTTP_Outbound_Internet",
            "properties": {
              "description": "This rule allows all Outbound HTTP traffic to the Internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('ProdDataSubnetAddressPrefix')]",
              "destinationPortRange": "80",
              "destinationAddressPrefix": "Internet",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 297
            }
          },
          {
            "name": "HTTPS_Outbound_Internet",
            "properties": {
              "description": "This rule allows all Outbound HTTPS traffic to the Internet",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('ProdDataSubnetAddressPrefix')]",
              "destinationPortRange": "443",
              "destinationAddressPrefix": "Internet",
              "access": "Allow",
              "direction": "Inbound",
              "priority": 298
            }
          },
          {
            "name": "Deny_Outbound_All",
            "properties": {
              "description": "This rule denies all Outbound traffic not otherwise allowed to all destinations",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "[parameters('ProdDataSubnetAddressPrefix')]",
              "destinationPortRange": "*",
              "destinationAddressPrefix": "*",
              "access": "Deny",
              "direction": "Inbound",
              "priority": 299
            }
          }
        ]
      }
    }
  ]
}
